---
title: "geniusr"
output: github_document
---

Tools for working with the Genius API.

- Genius Developers Site: [https://genius.com/developers](https://genius.com/developers)
- Genius API Docs: [https://docs.genius.com/](https://docs.genius.com/)


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Install

Development version

```{r install_dev, eval=FALSE}
devtools::install_github('ewenme/geniusr')
```

## Authenticate

1. [Create a Genius API client](https://genius.com/api-clients/new)
2. Generate a client access token from your [API Clients page](https://genius.com/api-clients)
3. Set your credentials in the System Environment variable `GENIUS_API_TOKEN` by calling the `genius_token()` function and entering your Genius Client Access Token when prompted.

## Use

```{r load_pkg}
library(geniusr)
library(dplyr)
library(tidytext)
```

### How many times did Kanye West say "good morning", on the track "Good Morning"?

```{r good_morning_count}
# Get song search results for the term 'good morning'
gm_search <- search_song(search_term = "good morning") %>%
  # look for Kanye as the primary artist
  filter(artist_name == "Kanye West")

# get lyrics
gm_lyrics <- scrape_lyrics(song_id = gm_search$song_id)

# tokenization of the lyrics
gm_lyrics %>%
  # get bigrams
  unnest_tokens(bigram, line, token = "ngrams", n = 2) %>%
  # count bigram frequency
  count(bigram) %>%
  # look for good morning
  filter(bigram == "good morning")
```

### What artist's have 'Lil' in their name?

```{r lil_names}
# return artist matches for term 'lil'
lil_artists <- search_artist(search_term = "Lil", n_results = 500)

# subset artist names with 'lil'
stringr::str_subset(lil_artists$artist_name, "Lil")
```

### 

```{r}

# get tracklist for damn
damn_tracklist <- scrape_tracklist(album_id = 337082)

# get lyrics for tracks
damn_lyrics <- purrr::map_df(damn_tracklist$song_lyric_url, scrape_lyrics_url)

# tokenization of the lyrics
tf_idf <- damn_lyrics %>%
  # get indiv. words
  unnest_tokens(word, line) %>%
  # remove stop words
  anti_join(stop_words) %>%
  count(song_lyric_url, word, sort = TRUE) %>%
  ungroup() %>%
  bind_tf_idf(word, song_lyric_url, n) %>%
  arrange(desc(tf_idf))

tf_idf %>%
  group_by(song_lyric_url) %>%
  top_n(5, tf_idf) %>%
  ungroup() %>%
  mutate(word = reorder(word, tf_idf)) %>%
  ggplot(aes(word, tf_idf, fill = song_lyric_url)) +
  geom_col(show.legend = FALSE) +
  facet_wrap(~ song_lyric_url, scales = "free") +
  ylab("tf-idf") +
  coord_flip()
```

